# OyaCo Lab

> 好奇心に、最高の相棒を。家族に、会話の架け橋を。

## はじめに

突然ですが、小さなお子さんを持つ親御さん、こんな経験はありませんか？

「パパ、なんで空は青いの？」「ママ、なんで月はついてくるの？」

子供の好奇心は無限大です。ある研究によると、**4歳の子供は1日に平均して200〜300回もの質問をする**と言われています。特に好奇心が旺盛な時期には、約2分に1回という驚異的な頻度で「なぜ？」が繰り返されます。

一方で、私たち親には時間がありません。共働き世帯の増加に伴い、平日に親子が一緒に過ごせる時間は**約2時間**。そのうち、純粋に会話をしている時間は**わずか25分**程度というデータもあります。

**「1日300回の質問」 vs 「1日25分の会話」。**

単純計算しても、1つの質問に対して親が割ける時間は**わずか5秒**しかありません。これでは、子供の「なぜ？」に正面から向き合うことは物理的に不可能です。

その結果、多くの親が「あとでね」と遮ってしまったり、スマホを見せたりしてやり過ごし、後になって「もっと話を聞いてあげればよかった」と**罪悪感（ギルティ）** を抱えています。

私たちは、この **「圧倒的な需要（子供の好奇心）と供給（親の時間）のミスマッチ」** こそが、現代の子育てにおける最大のペインポイントであると考えました。

そして開発したのが、**OyaCo Lab** です。

これは単なる子供向けの学習アプリではありません。**AIが子供の「好奇心の相棒」として300回の質問を受け止め、そこで得た発見を親に「会話のネタ」として届けることで、限られた25分の会話を「濃密な時間」に変える**ためのプロダクトです。

## 解決したかった課題

### 1. 構造的な「会話時間の欠乏」

子供の質問欲求に対して親のリソースは圧倒的に不足しています。東北大学の研究によれば、親子で「多様な会話」を持つ頻度は、子供の言語理解能力や脳（右上側頭回）の発達に直接的な影響を与えるとされています。しかし、日々の業務や家事に追われる中で、その時間を確保するのは至難の業です。

### 2. 「何を話せばいいかわからない」問題

いざ時間があっても、「今日学校どうだった？」「楽しかった」で会話が終了してしまう...。子供が今、具体的に何に興味を持っているのか（例えば「恐竜」といっても、ティラノサウルスの強さなのか、化石の発掘なのか）を把握できていないため、話を広げられないのです。

### 3. 親の心理的負担（罪悪感）

調査によると、6割以上の親が「子供への関わり方に自信がない」「申し訳ない」と感じています。「忙しいから」という理由で子供の好奇心をスルーしてしまった時の申し訳なさは、親の自己肯定感をも下げてしまいます。

## ソリューション: 発見とつながりのサイクル

OyaCo Lab は、子供とAIだけで完結するのではなく、そこから親子の会話が生まれる**「発見とつながりのサイクル」**をデザインしました。

```
1. Exploration（探求）→ 2. Bridge（架け橋）→ 3. Connection（対話）→ 1に戻る
```

### ① Exploration（探求）: 子供がAI博士と一緒に疑問を解決する

アプリを開くと、7人の個性豊かなAI博士たちが待っています。

| 博士 | 専門分野 | 口調の特徴 |
|---|---|---|
| 🔬 ニュートン博士 | 物理・化学・科学全般 | 「〜なんじゃよ」「ほっほっほ」 |
| 🌿 もりの隊長ハヤテ | 動物・植物・自然 | 「〜だよ！」「すごいんだ！」 |
| 🌙 ほしぞら先生ルナ | 宇宙・天文・地球 | 「〜かしら」「〜のよ」 |
| 📜 ものしり爺さんゲン | 歴史・文化・社会 | 「昔はのう…」「〜だったんじゃ」 |
| 🎨 いろどり先生パレット | 芸術・感情・表現 | 「わぁ、素敵！」「きれいだよね！」 |
| 🤖 テックン博士 | IT・テクノロジー | 「ピピッ！」「じつはね…」 |
| 😊 スマイル先生 | からだ・健康・生活 | 「〜だね」「大丈夫だよ」 |

子供が質問すると、**博士選定フェーズ（Expert Spotlight）** が始まります。ステージ上のライトが博士たちを順に照らし、「誰がこの質問に詳しいかな？」と探す演出が入ります。回答は**「文章 ＋ 音声 ＋ 挿絵」**がセットになったシーンごとに順次再生され、まるで絵本を読み聞かせてもらっているかのような体験を提供します。

### ② Bridge（架け橋）: AIがその体験を親に「会話のネタ」として翻訳する

子供と博士の会話ログを分析し、「子供が今、光の屈折に興味を持っています」という事実だけでなく、**「お風呂でシャワーを使って虹を作ってみよう、と誘ってみてください」**といった**具体的なアクションプラン**に翻訳して親に届けます。

- **AIからの会話きっかけ提案**: 「今日の会話の切り出し方」や、まだ触れていない分野への誘導を提案
- **子育てアドバイザー**: 子供と博士たちの過去の会話ログすべてを記憶した、パーソナライズされたチャットボット

### ③ Connection（対話）: 親子が会話を通じて、デジタルの知識をリアルの体験へ広げる

AIからのパスを受け取った親の一言が、子供の知識欲にさらに火をつけます。ただの「画面の中の体験」が、お風呂での実験や、夕方の散歩での発見といった**「リアルの体験」へと拡張**されていく。AIが親子の間に割って入るのではなく、**AIが黒子となって親子の会話をプロデュースし、日常の風景をすべて『科学の実験室』に変えていく**。それが OyaCo Lab で実現したい世界観です。

## 技術スタック

| カテゴリ | 技術 |
|---|---|
| フレームワーク | Next.js 16.1（App Router / Server Actions） |
| UI | React 19.2 / Tailwind CSS 4.x / shadcn/ui（Radix UI）/ Framer Motion |
| AI（テキスト生成） | Google Cloud Vertex AI — `gemini-2.5-flash` |
| AI（画像生成） | Google Cloud Vertex AI — `gemini-2.5-flash-image` |
| AI（音声合成） | Google Cloud Vertex AI TTS — `gemini-2.5-flash-tts`（Chirp 3 HD） |
| 認証 | Firebase Authentication（Google ログイン） |
| データベース | Cloud Firestore |
| ストレージ | Firebase Storage |
| デプロイ | Cloud Run（Docker マルチステージビルド） |
| 言語 | TypeScript（strict mode） |

## アーキテクチャ

### 全体構成

Server Actions をバックエンド層として活用し、REST API サーバーを別途構築しない BFF レス構成です。

```
Browser ── Server Actions ──▶ Next.js Server ── REST API ──▶ Vertex AI / Firebase
```

### 子供向けチャット: Orchestrator-Workers パターン

```
質問入力
  │
  ▼
Orchestrator（最適な博士を選定）
  │
  ▼
Expert Agent（起承転結4ステップで回答生成）
  │
  ├── Promise.all で並列実行 ──────────────────────┐
  │   ├ Educator Review（子供向けの分かりやすさチェック）│
  │   ├ 深掘り質問の自動生成                          │
  │   ├ 4パネル結合画像の生成                         │
  │   └ 最初のステップの音声生成                       │
  │                                                 │
  ▼                                                 │
ResultView に表示 ◀──────────────────────────────────┘
  │
  ▼
バックグラウンドで残りステップの音声を先読み生成
```

エージェント選定と回答生成を2つの Server Action に分離することで、選定完了の瞬間にスポットライト演出を開始し、回答生成の待ち時間をアニメーションで隠蔽しています。

### 保護者向けエージェント: ReAct パターン

Gemini Function Calling を活用し、LLM が親の質問に応じて分析ツールを自律的に選択・実行します。

| ツール | 機能 |
|---|---|
| `analyzeConversationHistory` | 指定期間のトピック・博士分布を分析 |
| `analyzeLearningProgress` | 今週 vs 先週の学習傾向を比較 |
| `identifyKnowledgeGaps` | 未探索分野を特定し探索を提案 |
| `suggestEnrichmentActivities` | 興味テーマに基づく多角的な活動提案 |

最大5ステップの ReAct ループで、複数ツールの分析結果を統合した具体的なアドバイスを生成します。

### 好奇心タイプ分類エンジン

子供の質問を10タイプ（博士・発明家・策士・芸術家・物語作家・ユーモア作家・冒険家・リーダー・飼育員・哲学者）に自動分類し、保護者ダッシュボードの統計や会話きっかけ提案のパーソナライズに活用しています。

## セットアップ

### 前提条件

- Node.js 20.x LTS
- Google Cloud プロジェクト（Vertex AI 有効化済み）
- Firebase プロジェクト（Authentication + Firestore + Storage を有効化）
- Google Cloud 認証（サービスアカウントキー or Application Default Credentials）

### インストール

```bash
git clone <repository-url>
cd kids-science-lab
npm install
```

### 環境変数の設定

`.env.example` をコピーして `.env.local` を作成します。

```bash
cp .env.example .env.local
```

`.env.local` に以下を設定してください:

```env
# Firebase（クライアント側）
NEXT_PUBLIC_FIREBASE_API_KEY=
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=
NEXT_PUBLIC_FIREBASE_PROJECT_ID=
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=
NEXT_PUBLIC_FIREBASE_APP_ID=
NEXT_PUBLIC_FIRESTORE_DB_NAME=

# Firebase（サーバー側 / Admin SDK）
FIREBASE_PROJECT_ID=
FIRESTORE_DB_NAME=

# Cloud Run 用 Firebase クライアント設定
FIREBASE_CLIENT_API_KEY=
FIREBASE_CLIENT_AUTH_DOMAIN=
FIREBASE_CLIENT_STORAGE_BUCKET=
FIREBASE_CLIENT_MESSAGING_SENDER_ID=
FIREBASE_CLIENT_APP_ID=

# 開発用デフォルト子供ID
NEXT_PUBLIC_DEFAULT_CHILD_ID=child1
```

### 開発サーバーの起動

```bash
npm run dev
```

ブラウザで http://localhost:3000 にアクセスしてください。

### 本番ビルド

```bash
npm run build
npm start
```

### Docker でのデプロイ

```bash
docker build -t oyaco-lab .
docker run -p 3000:3000 oyaco-lab
```

## ライセンス

このプロジェクトはプライベートリポジトリです。
