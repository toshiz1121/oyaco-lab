# Phase 2: エンタメ性強化 実装計画

## 概要
Phase 1のMVP（画像生成機能）に続き、ユーザー体験を向上させる「エンタメ機能」を実装します。
主な焦点は、生成された作品への**「意味付け（解説）」**と、複数の巨匠画風を比較して楽しむ**「対決（バトル）」**です。

## 実装機能

### 1. The Master's Voice (巨匠による作品解説) [US-2.1]
生成された絵画について、巨匠本人（AIペルソナ）が、その画風の特徴や表現の意図を語ります。

- **機能フロー**:
  1. 画像生成完了後、解説生成トリガー（自動またはボタン）
  2. バックエンドでLLM（Gemini Pro Text等）に対し、巨匠のペルソナで解説文を生成リクエスト
  3. 生成されたテキストをフロントエンドに返却
  4. フロントエンドでテキスト表示
  5. 「解説を聞く」ボタンで、ブラウザ標準のWeb Speech APIを使用して読み上げ

- **技術スタック**:
  - **LLM**: Rakuten AI Gateway (Gemini 1.5 Pro/Flash または利用可能なテキストモデル)
  - **Prompting**: `src/lib/artists.ts` の `voicePersona` を活用したシステムプロンプト
  - **TTS**: Web Speech API (`SpeechSynthesis`) - コストゼロ、日本語対応

### 2. Art Battle Mode (巨匠バトル) [US-2.2]
同じテーマで2人の巨匠に描かせ、画風の違いを直感的に比較します。

- **機能フロー**:
  1. トップページに「バトルモード」トグルまたは専用ページへのリンクを追加
  2. テーマ入力 + 巨匠を2人選択（ドラフトピック形式または単純選択）
  3. 「BATTLE START」ボタンで生成開始
  4. `Promise.all` で2つの画像生成リクエストを並列実行
  5. 結果画面で2枚の画像を左右（スマホなら上下）に並べて表示
  6. （Optional）「どちらが好き？」投票ボタン（ローカルステートのみの簡易実装から開始）

- **UI/UX**:
  - **VS画面**: 格闘ゲームのVS画面のような演出
  - **結果画面**: 比較しやすいSplit View

## 実装ステップ

### Step 1: テキスト生成基盤の整備
- `src/lib/gemini.ts` (新規): Rakuten AI Gatewayへの共通クライアント処理（認証ヘッダー等）を切り出し
- `src/app/actions.ts`: `generateArtworkAction` に加え、`generateArtistCommentAction` を追加

### Step 2: 解説機能の実装
- `src/components/ArtworkDescription.tsx`: 解説文表示コンポーネント
- `src/hooks/useTextToSpeech.ts`: Web Speech APIを扱うカスタムフック
- 生成結果画面への統合

### Step 3: バトルモードUIの実装
- `src/app/battle/page.tsx`: バトル専用ページ
- `src/components/BattleArena.tsx`: 2人の巨匠選択と対決演出
- 並列生成ロジックの実装

### Step 4: ブラッシュアップ
- ローディング演出の強化（「巨匠が筆を走らせています...」→「巨匠が作品を語ろうとしています...」）
- エラーハンドリング（片方だけ失敗した場合のUI等）

## データ構造の変更
現在のところDBは使用せずオンメモリ/ステートレスで動作しているため、スキーマ変更はなし。
解説文は一時的なステートとして保持する。

## タイムライン（目安）
1. 計画策定 & 技術検証: 完了
2. テキスト生成実装: Codeモードへ移行後すぐ
3. 解説UI/TTS実装: その後
4. バトルモード実装: その後
