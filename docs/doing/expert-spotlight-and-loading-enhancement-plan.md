# エージェント選択演出 & 画像生成ローディング画面 実装計画書

## 📋 概要

子供向けAIサイエンスラボアプリにおいて、AIエージェント（博士）が選択される瞬間と、画像生成中の待ち時間をより楽しく、ワクワクする体験に改善する。

---

## 🎯 実装目標

### 目標1: エージェント選択演出の強化
- 博士が選ばれた瞬間に「スポットライト」が当たる演出
- 「この博士が選ばれました！」という明確な演出
- なぜこの博士が選ばれたのかを子供にわかりやすく表示

### 目標2: 画像生成ローディング画面の新設
- 子供を飽きさせない楽しいローディング画面
- 進捗状況がわかる表示
- 待ち時間を楽しく過ごせる工夫

---

## 📊 現在のフロー vs 新しいフロー

### 現在のフロー
```
┌─────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────┐
│  入力   │ → │ 専門家選択中 │ → │ 考え中      │ → │  結果   │
│ (input) │    │ (selecting) │    │ (thinking)  │    │(result) │
└─────────┘    └─────────────┘    └─────────────┘    └─────────┘
                    ↑                    ↑
              ExpertSpotlight      ThinkingView
              （ルーレット風）    （考え中表示）
```

### 新しいフロー
```
┌─────────┐    ┌─────────────┐    ┌─────────────────┐    ┌─────────┐
│  入力   │ → │ 専門家選択中 │ → │ 画像生成中      │ → │  結果   │
│ (input) │    │ (selecting) │    │(imageGenerating)│    │(result) │
└─────────┘    └─────────────┘    └─────────────────┘    └─────────┘
                    ↑                      ↑
              ExpertSpotlight       ImageGeneratingView
              （スポットライト     （楽しいローディング）
                演出強化）
```

---

## 📁 編集・追加するファイル一覧

| ファイル | 種別 | 説明 |
|---------|------|------|
| `src/components/ExpertSpotlight.tsx` | 編集 | スポットライト演出の強化 |
| `src/components/ImageGeneratingView.tsx` | 新規 | 画像生成中ローディング画面 |
| `src/components/AgentChatInterface.tsx` | 編集 | 画面遷移フローの変更 |

---

## 📝 詳細設計

### 1. ExpertSpotlight.tsx の改良

#### 現在の動作
- 6人の博士が横並びで表示
- ルーレットのように順番にハイライト
- 選ばれた博士が決まると少し大きくなる
- 選定理由が下に表示される

#### 改良後の動作

**フェーズ1: ルーレット演出（現状維持）**
- 博士たちが順番に光る（約2-3秒）

**フェーズ2: スポットライト演出（新規追加）**
```
演出の流れ:
1. 画面が少し暗くなる（0.3秒）
2. 選ばれた博士に上からスポットライトが当たる
3. 他の博士は暗くフェードアウト
4. 選ばれた博士が画面中央に移動＆拡大
5. キラキラエフェクト＆ファンファーレ的な演出
6. 「〇〇はかせに決定！」のテキスト表示
```

**フェーズ3: 選定理由の表示（強化）**
```
表示内容:
┌────────────────────────────────────┐
│     🎉 りかはかせ に決定！ 🎉      │
│                                    │
│    [博士の大きなアバター画像]       │
│                                    │
│  ┌──────────────────────────────┐  │
│  │ 💡 えらばれたりゆう          │  │
│  │                              │  │
│  │ 「なんで空は青いの？」は     │  │
│  │ 光のふしぎについてのしつもん │  │
│  │ だから、りかはかせが         │  │
│  │ いちばんくわしいよ！         │  │
│  └──────────────────────────────┘  │
└────────────────────────────────────┘
```

#### 必要なProps（変更なし）
```typescript
interface ExpertSpotlightProps {
  selectedExpert?: AgentRole;      // 選ばれた博士のID
  selectionReason?: string;        // 選定理由
  question?: string;               // 子供の質問
  onAnimationComplete?: () => void; // 演出完了時のコールバック
}
```

#### 実装ポイント
- framer-motionを使用したアニメーション
- スポットライト効果はCSS gradientで実現
- 演出時間は合計約4-5秒（子供が理解できる速度）

---

### 2. ImageGeneratingView.tsx の新規作成

#### 目的
画像生成中（約10-30秒）の待ち時間を、子供が飽きずに楽しく過ごせるようにする。

#### 画面構成
```
┌────────────────────────────────────────┐
│                                        │
│     きみのしつもん                      │
│  ┌──────────────────────────────────┐  │
│  │ なんで空は青いの？               │  │
│  └──────────────────────────────────┘  │
│                                        │
│         [博士のアバター]                │
│         （絵を描くアニメーション）       │
│                                        │
│     🎨 りかはかせが絵を描いているよ     │
│                                        │
│     ┌────────────────────────┐         │
│     │████████░░░░░░░░░░░░░░░│ 35%     │
│     └────────────────────────┘         │
│                                        │
│  ┌──────────────────────────────────┐  │
│  │ 💡 まめちしき                    │  │
│  │                                  │  │
│  │ 空が青いのは、太陽の光が         │  │
│  │ 空気にぶつかるからなんだよ！     │  │
│  └──────────────────────────────────┘  │
│                                        │
│     ✨ もうすぐできるよ！ ✨           │
│                                        │
└────────────────────────────────────────┘
```

#### 子供を飽きさせない工夫

**1. 博士のアニメーション**
- 博士が筆を持って絵を描いている動き
- 時々「うーん」と考えるポーズ
- 完成が近づくと嬉しそうな表情

**2. 進捗バー**
- カラフルな虹色のプログレスバー
- パーセンテージ表示
- 進捗に応じたメッセージ変化:
  - 0-30%: 「かんがえているよ...」
  - 30-60%: 「えをかいているよ...」
  - 60-90%: 「もうすこしだよ！」
  - 90-100%: 「できあがり！」

**3. 豆知識の表示**
- 質問に関連した簡単な豆知識
- 5-10秒ごとに切り替わる
- 子供が読める簡単な日本語

**4. 背景エフェクト**
- ゆっくり浮かぶ泡
- キラキラ光る星
- 虹色のグラデーション背景

**5. 励ましメッセージ**
- 「もうすぐできるよ！」
- 「たのしみにまっててね！」
- 「すごいえができるよ！」

#### Props設計
```typescript
interface ImageGeneratingViewProps {
  agent: Agent;                    // 選ばれた博士
  question: string;                // 子供の質問
  progress?: number;               // 進捗（0-100）
  currentStep?: string;            // 現在のステップ説明
}
```

#### 実装ポイント
- framer-motionでスムーズなアニメーション
- 進捗は親コンポーネントから受け取る
- 豆知識は配列からランダムまたは順番に表示
- レスポンシブ対応（モバイル/デスクトップ）

---

### 3. AgentChatInterface.tsx の変更

#### ViewModeの変更
```typescript
// 現在
type ViewMode = 'input' | 'selecting' | 'thinking' | 'result';

// 変更後
type ViewMode = 'input' | 'selecting' | 'imageGenerating' | 'result';
```

#### 画面遷移ロジックの変更

**現在のフロー:**
```
selecting → (演出完了) → thinking → (API完了) → result
```

**新しいフロー:**
```
selecting → (演出完了) → imageGenerating → (画像生成完了) → result
```

#### 進捗管理の追加
```typescript
// 新しいstate
const [generationProgress, setGenerationProgress] = useState(0);

// 進捗更新（画像生成APIからのコールバック）
// または、時間ベースの擬似進捗
```

---

## 🎨 デザインガイドライン

### カラーパレット
- メインカラー: 青系 (`blue-500`, `blue-600`)
- アクセント: 黄色 (`yellow-400`) - スポットライト
- 背景: 白〜薄い青のグラデーション
- テキスト: 濃い青 (`blue-900`)

### フォント
- 見出し: 太字（bold）
- 本文: 中太（medium）
- ひらがな多め、漢字には読み仮名

### アニメーション
- 動きは滑らかに（ease-in-out）
- 速すぎず遅すぎず（子供が追える速度）
- 派手すぎない（目が疲れない）

---

## 📅 実装順序

### ステップ1: ExpertSpotlight.tsx の改良
1. スポットライト効果のCSS追加
2. 選ばれた博士の拡大・中央移動アニメーション
3. 選定理由表示の強化
4. 動作確認

### ステップ2: ImageGeneratingView.tsx の新規作成
1. 基本レイアウトの作成
2. 博士アニメーションの実装
3. 進捗バーの実装
4. 豆知識表示の実装
5. 背景エフェクトの追加
6. 動作確認

### ステップ3: AgentChatInterface.tsx の変更
1. ViewModeの変更
2. 画面遷移ロジックの修正
3. 進捗管理の追加
4. 全体フローの動作確認

### ステップ4: 最終調整
1. アニメーションのタイミング調整
2. レスポンシブ対応の確認
3. パフォーマンス確認

---

## ✅ 完了条件

- [ ] 博士選択時にスポットライト演出が表示される
- [ ] 選定理由が子供にわかりやすく表示される
- [ ] 画像生成中に楽しいローディング画面が表示される
- [ ] 進捗バーが動作する
- [ ] 子供が飽きない工夫（アニメーション、豆知識）が実装されている
- [ ] モバイル・デスクトップ両方で正しく表示される
- [ ] 画面遷移がスムーズに動作する

---

## 📝 備考

- 既存の `ThinkingView.tsx` は `ImageGeneratingView.tsx` に置き換えられるが、削除せず残しておく（将来的に別用途で使用する可能性）
- 豆知識のコンテンツは後から追加・編集可能な構造にする
- アニメーションの速度は実際に子供に見せてフィードバックを得て調整する
