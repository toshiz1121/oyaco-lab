# Phase 8: 作品管理・修正・リミックス機能 - ユーザーストーリー

**最終更新**: 2026-01-06  
**ステータス**: レビュー中

---

## 📋 インタビュー結果サマリー

### ユーザーの動機

1. **リミックス機能**: 実験的に遊びたい（「この絵をダリで描いたらどうなる？」という好奇心）
2. **作品履歴**: 試行錯誤の途中で「あ、さっきの方が良かった」と戻りたい
3. **画像アップロード**: 自由にリミックスできる（自分の写真、過去の作品、他ツールの画像）

### 優先順位の変更 ⚠️

**Architectの提案**: Phase 8.1（リミックス）→ 8.2（履歴）→ 8.3（アップロード）

**ユーザーの意向**: **アップロードが最重要**

**理由**: 
- アップロードがあれば、過去の作品を再アップロードして自由にリミックスできる
- 履歴機能や比較機能は、アップロード+リミックスの実装を整理してから考える方が本質的
- 「リミックス = ある画像をベースに加工を指示する」という本質を先に実装すべき

### リミックスの本質 💡

> 「通常のChatGPTとかのように画像をアップしてかつ指示できるようなのを想定しているだけだよ。Rooと話しているときもそうじゃん。」

**重要な洞察**:
- リミックスは「画像 + テキスト指示」を同時に送れるインターフェース
- 例: 「2人映っている写真を渡して左の人だけ写楽風にして」
- ChatGPT/Rooと同じUX（画像+指示を一緒に送る）

---

## 🎯 MVP（Minimum Viable Product）の再定義

### Phase 8.1: 画像アップロード + リミックス機能 ⭐️ **最優先**

**目的**: 
- 現在の問題（巨匠切り替え時のスタイル維持）を解決
- 自由なリミックスの基盤を作る
- ChatGPT/Rooと同じUX（画像+指示）を実現

**実装内容**:
1. 画像アップロード機能（ドラッグ&ドロップ）
2. テキスト指示入力欄（オプション）
3. 画像+指示+巨匠の画風で生成
4. 生成画像のリミックス機能（巨匠切り替え対応）

**作品履歴**: 最新1件のみ保持（シンプルに）

---

## 📝 ユーザーストーリー

### US-8.1: 画像をアップロードして巨匠風に変換する ⭐️ **Critical**

**As a** アート愛好家  
**I want to** 自分の写真や画像をアップロードして、テキスト指示と一緒に巨匠の画風に変換できる  
**So that** ChatGPTやRooのように、画像+指示で細かく制御できる

**Acceptance Criteria**:
1. 左カラムに「画像をアップロード」エリアがある
2. ドラッグ&ドロップで画像をアップロードできる
3. ファイル選択ダイアログからも画像を選択できる
4. アップロード後、巨匠を選択できる
5. テキスト入力欄に追加指示を入力できる（オプション）
6. 「変換」ボタンをクリックすると、画像+指示+巨匠の画風で生成される
7. 変換後の画像がCanvasに表示される
8. 変換後の画像をダウンロードできる

**Edge Cases**:
- ファイルサイズが大きすぎる場合（10MB制限）
- 画像形式が非対応の場合（PNG, JPEG, WebP以外）
- アップロード中にエラーが発生した場合
- 変換に失敗した場合（元画像は保持される）
- 追加指示が複雑すぎる場合（プロンプトの長さ制限）

**ユーザーシナリオ1: シンプルな変換**:
```
1. ユーザーが自分の猫の写真を持っている
2. 「画像をアップロード」エリアに写真をドラッグ&ドロップ
3. 写真がCanvasに表示される
4. 左カラムでダリを選択
5. テキスト入力欄は空のまま
6. 「変換」ボタンをクリック
7. ローディング表示（約10秒）
8. ダリ風の猫の絵が生成される
9. 「すごい！」と感動してダウンロード
```

**ユーザーシナリオ2: 追加指示付き変換**:
```
1. ユーザーが2人映っている写真をアップロード
2. 左カラムで写楽を選択
3. テキスト入力欄に「左の人だけ写楽風にして」と入力
4. 「変換」ボタンをクリック
5. ローディング表示（約10秒）
6. 左の人だけが写楽風になった絵が生成される
7. 「面白い！右の人も試してみよう」
8. 「右の人だけ写楽風にして」と入力して再変換
```

**技術的考慮事項**:
- Base64変換（クライアント側）
- ファイルサイズ制限（10MB）
- 画像形式のバリデーション
- 画像+テキスト指示を同時にGemini APIに送信
- プロンプト構築: `{追加指示} Transform this image in the style of {artist.nameEn} ({artist.style})`
- エラーハンドリング

**UI設計**:
```
┌─────────────────────────────────────┐
│ 📤 画像をアップロード               │
│ ┌─────────────────────────────────┐ │
│ │ ドラッグ&ドロップ               │ │
│ │ または                          │ │
│ │ [ファイルを選択]                │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 🎨 巨匠を選択                       │
│ [ピカソ] [ゴッホ] [ダリ] ...       │
│                                     │
│ 📝 追加指示（オプション）           │
│ ┌─────────────────────────────────┐ │
│ │ 例: 左の人だけ写楽風にして      │ │
│ └─────────────────────────────────┘ │
│                                     │
│ [変換]                              │
└─────────────────────────────────────┘
```

**優先度**: 🔴 Critical

---

### US-8.2: 生成した作品を別の巨匠でリミックスする ⭐️ **Critical**

**As a** アート愛好家  
**I want to** 生成した作品を別の巨匠の画風で描き直せる  
**So that** 「この絵をダリで描いたらどうなる？」という好奇心を満たせる

**Acceptance Criteria**:
1. 作品生成後、別の巨匠を選択できる
2. 巨匠が異なる場合、「⚠️ 巨匠が異なります」アラートが表示される
3. アラート内に「[巨匠名]の画風で描き直す」ボタンがある
4. ボタンをクリックすると、新しい画風で生成される
5. 生成中は「リミックス中...」のローディング表示がある
6. 生成後、新しい作品がCanvasに表示される
7. 元の作品は上書きされる（シンプルに）

**Edge Cases**:
- リミックスに失敗した場合（元画像は保持される）
- リミックス中にキャンセルしたい場合
- 連続でリミックスを実行した場合（レート制限）
- 画風の相性が悪い組み合わせ（例: 浮世絵→キュビズム）

**ユーザーシナリオ**:
```
1. ユーザーがピカソで「猫」を生成
2. 作品を見て「ダリでも見てみたい」と思う
3. 左カラムでダリを選択
4. 「⚠️ 巨匠が異なります」アラートが表示
5. 「ダリの画風で描き直す」ボタンをクリック
6. ローディング表示（約10秒）
7. ダリ風の猫が生成される
8. 「面白い！ゴッホでも試してみよう」
9. ゴッホを選択してリミックス
10. 複数の画風を試して楽しむ
```

**技術的考慮事項**:
- 現在の作品の`artistId`と選択中の`artistId`の比較
- リミックス用のプロンプト設計（構図維持）
- レート制限（1分に3回まで）
- エラーハンドリング

**優先度**: 🔴 Critical

---

### US-8.3: アップロード画像をリミックスする ⭐️ **Critical**

**As a** アート愛好家  
**I want to** アップロードした画像を複数の巨匠でリミックスできる  
**So that** 自分の写真を様々な画風で楽しめる

**Acceptance Criteria**:
1. 画像アップロード後、別の巨匠を選択できる
2. US-8.2と同じリミックス機能が使える
3. 元のアップロード画像は保持される（再アップロード不要）
4. 複数回リミックスできる

**Edge Cases**:
- アップロード画像が巨匠の画風と合わない場合
- リミックスを繰り返すと品質が劣化する可能性

**ユーザーシナリオ**:
```
1. ユーザーが自分の顔写真をアップロード
2. ピカソを選択して変換
3. 「ダリでも見てみたい」と思う
4. ダリを選択してリミックス
5. 「ゴッホでも試そう」
6. ゴッホを選択してリミックス
7. 複数の画風を試して、一番気に入ったものをダウンロード
```

**技術的考慮事項**:
- アップロード画像の保持（メモリ管理）
- リミックスの連鎖による品質劣化の警告

**優先度**: 🔴 Critical

---

### US-8.4: 過去の作品を再利用する 🟢 **Medium**

**As a** アート愛好家  
**I want to** 過去にダウンロードした作品を再アップロードして、続きからリミックスできる  
**So that** セッションをまたいで作業を続けられる

**Acceptance Criteria**:
1. ダウンロードした画像を再アップロードできる
2. US-8.3と同じリミックス機能が使える
3. 元の巨匠情報は失われる（新しい画像として扱う）

**Edge Cases**:
- ダウンロード時に画質が劣化している場合
- 他のツールで編集された画像の場合

**ユーザーシナリオ**:
```
1. ユーザーが昨日ピカソで作った作品をダウンロード済み
2. 今日、その画像を再アップロード
3. ゴッホを選択してリミックス
4. 新しい作品を楽しむ
```

**技術的考慮事項**:
- 画像のメタデータは失われる（元の巨匠情報なし）
- 新しい画像として扱う

**優先度**: 🟢 Medium

---

## 🚫 Phase 8.1では実装しない機能

以下の機能は、Phase 8.1の後に検討します：

### 作品履歴管理（Phase 8.2以降）
- 複数作品の保持
- サムネイル一覧
- 前後ナビゲーション
- 作品の系譜表示

**理由**: アップロード+リミックスの実装を整理してから、履歴管理の必要性を再評価する

### 作品比較機能（Phase 8.3以降）
- Before/After表示
- 複数作品の並列比較

**理由**: 履歴管理が実装されてから検討

### 複数画像の融合（Phase 8.4以降）
- 2つの画像を融合
- スタイルミックス

**理由**: 指示が難しいため、後回し

---

## 📊 Phase 8.1の実装スコープ

### 実装する機能

1. **画像アップロード**
   - ドラッグ&ドロップ
   - ファイル選択
   - バリデーション（サイズ、形式）

2. **テキスト指示入力**
   - オプションの入力欄
   - プレースホルダー例の表示

3. **リミックス機能**
   - 画像+指示+巨匠の画風で生成
   - 巨匠切り替え検知
   - アラート表示
   - リミックス実行

4. **基本的なState管理**
   - 現在の作品（1件のみ）
   - 選択中の巨匠
   - アップロード状態

### 実装しない機能

- 作品履歴（複数保持）
- サムネイル一覧
- 作品比較
- 作品の系譜表示
- お気に入り機能
- 削除機能

---

## 🎯 成功基準

Phase 8.1が成功したと言えるのは：

1. ✅ ユーザーが自分の写真をアップロードして、巨匠風に変換できる
2. ✅ 「左の人だけ写楽風にして」のような追加指示ができる
3. ✅ 生成した作品を別の巨匠でリミックスできる
4. ✅ アップロード画像を複数の巨匠でリミックスできる
5. ✅ 現在の問題（巨匠切り替え時のスタイル維持）が解決されている
6. ✅ ユーザーが「実験的に遊べる」と感じる
7. ✅ ChatGPT/Rooと同じUX（画像+指示）を実現できている

---

## 🔄 Phase 8.2以降の検討事項

Phase 8.1の実装後、以下を検討します：

### 検討1: 作品履歴は本当に必要か？

**質問**:
- アップロード+リミックスで十分ではないか？
- 履歴管理のコストに見合う価値があるか？

**判断基準**:
- ユーザーが「戻りたい」と感じる頻度
- ダウンロード→再アップロードの手間
- メモリ使用量の増加

### 検討2: 作品比較は必要か？

**質問**:
- 複数の画風を並べて見たいか？
- それとも1つずつ見れば十分か？

**判断基準**:
- ユーザーの使い方（連続リミックス vs 単発）
- UI/UXの複雑さ

---

## 📚 参考

- Architectの設計書: [`tools/master-piece/docs/todo/phase8-artwork-management-plan.md`](todo/phase8-artwork-management-plan.md)
- 既存のユーザーストーリー: [`tools/master-piece/docs/user-stories.md`](user-stories.md)
- 現在の実装: [`tools/master-piece/src/app/actions.ts`](../src/app/actions.ts:306)
