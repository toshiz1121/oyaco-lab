# GCP 初期設定ガイド

このガイドでは、Google Cloud Platform (GCP) を初めて使う方向けに、アカウントの作成からgcloud CLIの設定までを説明します。

## 1. Googleアカウントの準備

GCPを使用するには、Googleアカウントが必要です。

- **既にGmailアカウントを持っている場合**: そのアカウントをそのまま使用できます。
- **持っていない場合**: [Googleアカウント作成ページ](https://accounts.google.com/signup)から作成してください。

## 2. GCPプロジェクトの作成

### 2.1 Google Cloud Consoleにアクセス

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセスします。
2. Googleアカウントでログインします。
3. 初回アクセス時は利用規約への同意が求められるので、内容を確認して同意してください。

### 2.2 新しいプロジェクトを作成

1. 画面上部のプロジェクト選択ドロップダウンをクリックします。
2. 「新しいプロジェクト」をクリックします。
3. プロジェクト名を入力します（例: `kids-science-lab-prod`）。
4. 「作成」ボタンをクリックします。

**プロジェクトIDについて**: プロジェクト名とは別に、システムが自動生成するプロジェクトIDが割り当てられます。このIDは後で使用するのでメモしておいてください。

## 3. 課金の有効化

GCPの無料枠を利用する場合でも、課金アカウントの登録が必要です。

### 3.1 無料トライアルの利用（初回のみ）

初めてGCPを使用する場合、**$300分の無料クレジット（90日間有効）**が提供されます。

1. Google Cloud Consoleの右上にある「無料トライアルを有効にする」をクリックします。
2. 以下の情報を入力します:
   - 国/地域
   - 利用規約への同意
   - クレジットカード情報（本人確認用。無料期間中は自動的に課金されません）
3. 「開始」をクリックします。

### 3.2 課金アカウントの設定（無料期間終了後）

無料トライアル終了後は、以下の手順で課金を有効化します:

1. 左側メニューから「お支払い」を選択します。
2. 「請求先アカウントをリンク」をクリックします。
3. 既存の請求先アカウントを選択するか、新しいアカウントを作成します。

**重要**: 無料枠内であれば料金は発生しません。詳細は[GCP無料枠](https://cloud.google.com/free)を参照してください。

## 4. gcloud CLI のインストール

gcloud CLIは、ターミナルからGCPを操作するためのコマンドラインツールです。

### 4.1 macOS の場合

```bash
# Homebrewを使用してインストール
brew install google-cloud-sdk
```

### 4.2 Windows の場合

1. [Google Cloud SDK インストーラー](https://cloud.google.com/sdk/docs/install#windows)をダウンロードします。
2. インストーラーを実行し、画面の指示に従います。

### 4.3 Linux の場合

```bash
# 最新版のダウンロードと展開
curl https://sdk.cloud.google.com | bash

# シェルを再起動
exec -l $SHELL
```

## 5. gcloud CLI の初期設定

インストール後、以下のコマンドで初期設定を行います。

```bash
# 初期化
gcloud init
```

以下の質問に答えます:

1. **アカウントの選択**: ブラウザが開くので、Googleアカウントでログインします。
2. **プロジェクトの選択**: 先ほど作成したプロジェクトを選択します。
3. **デフォルトリージョンの設定**: `asia-northeast1` (東京) を推奨します。

### 5.2 設定の確認

```bash
# 現在の設定を確認
gcloud config list

# 出力例:
# [core]
# account = your-email@gmail.com
# project = kids-science-lab-prod
```

## 6. 必要なAPIの有効化

デプロイに必要なGCP APIを有効化します。

```bash
gcloud services enable \
    run.googleapis.com \
    artifactregistry.googleapis.com \
    secretmanager.googleapis.com \
    cloudbuild.googleapis.com
```

**実行時間**: 初回は数分かかる場合があります。

## 7. 次のステップ

ここまでの設定が完了したら、[`docs/deploy-gcp.md`](./deploy-gcp.md) の手順に従って、実際のデプロイを進めてください。

---

## トラブルシューティング

### gcloud コマンドが見つからない

**症状**: `command not found: gcloud`

**解決方法**:
- インストール後、シェルを再起動してください。
- macOSの場合: `source ~/.zshrc` または `source ~/.bash_profile`

### プロジェクトIDが分からない

```bash
# すべてのプロジェクトを一覧表示
gcloud projects list
```

### 課金アカウントが見つからない

Google Cloud Consoleの「お支払い」セクションから、課金アカウントの状態を確認してください。無料トライアルが有効になっているか確認します。

---

## よくある質問

**Q: 無料枠を超えたら自動的に課金されますか？**
A: 無料トライアル中は、$300のクレジットを使い切っても自動的には課金されません。無料期間終了後は、明示的に有料アカウントにアップグレードしない限り課金されません。

**Q: 個人のGmailアカウントを使っても大丈夫ですか？**
A: はい、個人アカウントでも問題ありません。本番環境として長期運用する場合は、専用のアカウントを作成することを推奨します。

**Q: 複数のGCPプロジェクトを持てますか？**
A: はい、1つのGoogleアカウントで複数のプロジェクトを管理できます。開発環境と本番環境で分ける場合などに便利です。
